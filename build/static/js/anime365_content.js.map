{"version":3,"file":"static/js/anime365_content.js","mappings":"yBACA,IAAIA,EACAC,EAAwB,EACxBC,EAAwB,EAC5BC,OAAOC,QAAQC,UAAUC,aAAY,SAAUC,GAE3C,GAAIA,GAA4B,2BAAjBA,EAAQC,OAEnBC,cAAcT,GAEdE,EAAgB,EAEZQ,SAASC,eAAe,eAAe,CACvC,IAAMC,EAAaF,SAASC,eAAe,cACrCE,EAA6BD,EAAYE,cAE/Cd,EAAUe,YAAW,SAASC,IAE1B,IAAMC,EAAMJ,EAAQH,SAASQ,uBAAuB,qBAAqBC,KAAK,GAAIC,aAAa,SAAUC,OAGzG,GAFApB,EAAgBqB,SAASL,EAAIM,QAAQ,gDAAiD,OAElFX,GAAcX,GAAiB,GAAI,CAEnC,IAAMuB,EAAYX,EAAQH,SAASC,eAAe,uBAElD,GAAKa,IA2BDtB,GACqB,KACjBQ,SAASe,SAASC,KAAOhB,SAASQ,uBAAuB,4BAA4BC,KAAK,GAAIQ,qBAAqB,KAAKR,KAAK,GAASO,MAG1IF,EAAUG,qBAAqB,KAAKR,KAAK,GAAIS,MAAMC,YAAY,UAA4B,IAAhB3B,EAAuB,GAAK,SAhC3F,CAEZ,IAAM4B,EAAMpB,SAASqB,cAAc,OAC7BC,EAAItB,SAASqB,cAAc,KAC3BE,EAAOvB,SAASqB,cAAc,QACpCD,EAAII,GAAK,sBACTD,EAAKE,UAAY,iCACjBH,EAAEI,MAAQ,6HACVJ,EAAEK,QAAU,WAAa,IAAD,EAEpB5B,cAAcT,GACwC,QAAtD,EAAAa,EAAQH,SAASC,eAAe,8BAAsB,OAAtD,EAAwD2B,SACxDpC,EAAgB,CACpB,EACA4B,EAAIS,YAAYP,GAAGO,YAAYN,GACbpB,EAAQH,SAAS8B,KAAKD,YAAY7B,SAASqB,cAAc,UACjEU,UAAY,+sBAMtB,IAAMC,EAAY7B,EAAQH,SAASQ,uBAAuB,mBAAmBC,KAAK,GACnEuB,EAAUC,WAClBC,aAAad,EAAKY,EAC7B,CASJ,KAAO,CAAC,IAAD,EAEHxC,EAAgB,EACsC,QAAtD,EAAAW,EAAQH,SAASC,eAAe,8BAAsB,OAAtD,EAAwD2B,QAC5D,CACAtC,EAAUe,WAAWC,EAAM,IAC/B,GAAG,IAEP,CAER,G","sources":["chromeServices/anime365_content.ts"],"sourcesContent":["export {}\r\nlet timerId: string | number | NodeJS.Timeout | undefined;\r\nlet countNextPage: number = 0;\r\nlet countTimerOut: number = 0;\r\nchrome.runtime.onMessage.addListener(function (request) {\r\n    // Получаем сообщение от background что страница готова\r\n    if (request && request.type === 'page-rendered-anime365') {\r\n        //Очистим таймер если есть\r\n        clearInterval(timerId);\r\n        //Обнулим таймер перехода\r\n        countTimerOut = 0;\r\n        //Проверим наличие плеера\r\n        if (document.getElementById(\"videoFrame\")) {\r\n            const videoFrame = document.getElementById(\"videoFrame\")!;\r\n            const iFrame = (<HTMLIFrameElement>videoFrame).contentWindow;\r\n            //Запустим таймер\r\n            timerId = setTimeout(function tick() {\r\n                //Получим состояние полоски загрузки\r\n                const str = iFrame!.document.getElementsByClassName(\"vjs-play-progress\").item(0)!.getAttribute(\"style\")!.trim();\r\n                countNextPage = parseInt(str.replace(/^width: ([0-9]{1,2})(.{0,1})?([0-9]{0,2})?%;$/, \"$1\"));\r\n                //Если просмотренно более 96% тайтла запускаем отображение пропуска\r\n                if (videoFrame && countNextPage >= 96) {\r\n                    //Вернём наличие нашего блока\r\n                    const mainBlock = iFrame!.document.getElementById(\"answer_is_forty_two\");\r\n                    //Если блока нет\r\n                    if (!mainBlock) {\r\n                        //Созданим элементы блока\r\n                        const div = document.createElement('div');\r\n                        const a = document.createElement('a');\r\n                        const span = document.createElement('span');\r\n                        div.id = \"answer_is_forty_two\";\r\n                        span.innerText = \"Далее\";\r\n                        a.title = \"Нажмите чтобы отменить\";\r\n                        a.onclick = function () {\r\n                            //При нажатии на блок очистим таймер и удалим блок\r\n                            clearInterval(timerId);\r\n                            iFrame!.document.getElementById(\"answer_is_forty_two\")?.remove();\r\n                            countTimerOut = 0;\r\n                        }\r\n                        div.appendChild(a).appendChild(span);\r\n                        const styleElem = iFrame!.document.head.appendChild(document.createElement(\"style\"));\r\n                        styleElem.innerHTML = \"#answer_is_forty_two{background-color: #ff6d0033; border-radius: 2px; position:absolute; bottom:70px; right:20px; transform: translate(-50%, -50%);}\" +\r\n                            \"#answer_is_forty_two a{display: block; cursor: pointer; width: 200px; height: 40px; line-height: 40px; font-size: 18px; font-family: sans-serif; text-decoration: none; color: #333;border: 1px solid #333;letter-spacing: 2px;text-align: center;position: relative;transition: all .35s;}\" +\r\n                            \"#answer_is_forty_two a:after{position: absolute; content: \\\"\\\"; top: 0; left: 0; width: var(--width, 0); height: 100%; background: #ff6d00; transition: all .35s;}\" +\r\n                            \"#answer_is_forty_two a:hover{color: #fff; background: #ff6d0088;}\" +\r\n                            \"#answer_is_forty_two a span{position: relative; z-index: 2;}\";\r\n                        //Добавим блок во фрейм\r\n                        const container = iFrame!.document.getElementsByClassName(\"vjs-control-bar\").item(0)!;\r\n                        const parent = container.parentNode!\r\n                        parent.insertBefore(div, container)\r\n                    } else {\r\n                        //Считаем 25 секунд и переходим по ссылке\r\n                        countTimerOut++;\r\n                        if (countTimerOut >= 25) {\r\n                            document.location.href = document.getElementsByClassName(\"m-select-sibling-episode\").item(0)!.getElementsByTagName(\"a\").item(1 || 0)!.href;\r\n                        }\r\n                        //Визуализируем счётчик\r\n                        mainBlock.getElementsByTagName(\"a\").item(0)!.style.setProperty(\"--width\", (countTimerOut * 100) / 25 + \"%\");\r\n                    }\r\n                } else {\r\n                    //Если ещё не досмотрено 96% то ничего не делаем\r\n                    countTimerOut = 0;\r\n                    iFrame!.document.getElementById(\"answer_is_forty_two\")?.remove();\r\n                }\r\n                timerId = setTimeout(tick, 1000); // (*)\r\n            }, 1000);\r\n\r\n        }\r\n    }\r\n});\r\n\r\n"],"names":["timerId","countNextPage","countTimerOut","chrome","runtime","onMessage","addListener","request","type","clearInterval","document","getElementById","videoFrame","iFrame","contentWindow","setTimeout","tick","str","getElementsByClassName","item","getAttribute","trim","parseInt","replace","mainBlock","location","href","getElementsByTagName","style","setProperty","div","createElement","a","span","id","innerText","title","onclick","remove","appendChild","head","innerHTML","container","parentNode","insertBefore"],"sourceRoot":""}